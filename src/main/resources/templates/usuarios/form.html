<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org" th:replace="~{layout :: layout(~{::section})}">
<section>
    <nav class="breadcrumbs" sec:authorize="isAuthenticated()">
        <a th:href="@{/}">Inicio</a>
        <span class="breadcrumb-separator">/</span>
        <a th:href="@{/usuarios}">Usuarios</a>
        <span class="breadcrumb-separator">/</span>
        <span class="breadcrumb-current" th:text="${isEdit} ? 'Editar' : 'Nuevo'">Formulario</span>
    </nav>
    <div class="page-header">
        <div>
            <h1 th:text="${isEdit} ? 'Editar usuario' : 'Nuevo usuario'">Formulario</h1>
            <p th:text="${isEdit} ? 'Modifica los datos del usuario del sistema' : 'Crea un nuevo usuario con acceso al sistema'">
                Descripción del formulario
            </p>
        </div>
        <a class="button" th:href="@{/usuarios}">
            <svg class="button-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M19 12H5M12 19l-7-7 7-7"/>
            </svg>
            Volver
        </a>
    </div>

    <div class="card form-card">
        <form th:action="@{${action}}" th:object="${usuarioForm}" method="post">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
            
            <div class="form-section">
                <div class="form-section-header">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                        <circle cx="12" cy="7" r="4"/>
                    </svg>
                    <h3>Datos personales</h3>
                </div>
                <div class="form-grid">
                    <div class="form-field">
                        <label class="form-label" for="username">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                                <circle cx="12" cy="7" r="4"/>
                            </svg>
                            Nombre de usuario
                            <span class="required">*</span>
                        </label>
                        <input id="username" type="text" class="form-input" th:field="*{username}" 
                               placeholder="Ej: jgarcia" required>
                        <span class="form-hint">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <path d="M12 16v-4M12 8h.01"/>
                            </svg>
                            Identificador único para iniciar sesión
                        </span>
                        <div class="form-error" th:if="${#fields.hasErrors('username')}">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <path d="M12 8v4M12 16h.01"/>
                            </svg>
                            <span th:errors="*{username}">Error</span>
                        </div>
                    </div>

                    <div class="form-field">
                        <label class="form-label" for="nombre">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                                <circle cx="8.5" cy="7" r="4"/>
                            </svg>
                            Nombre completo
                            <span class="required">*</span>
                        </label>
                        <input id="nombre" type="text" class="form-input" th:field="*{nombre}" 
                               placeholder="Ej: Juan García López" required>
                        <div class="form-error" th:if="${#fields.hasErrors('nombre')}">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <path d="M12 8v4M12 16h.01"/>
                            </svg>
                            <span th:errors="*{nombre}">Error</span>
                        </div>
                    </div>

                    <div class="form-field full-width">
                        <label class="form-label" for="email">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
                                <path d="M22 6l-10 7L2 6"/>
                            </svg>
                            Email
                            <span class="required">*</span>
                        </label>
                        <input id="email" type="email" class="form-input" th:field="*{email}" 
                               placeholder="Ej: juan.garcia@garagegest.com" required>
                        <span class="form-hint">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <path d="M12 16v-4M12 8h.01"/>
                            </svg>
                            Correo electrónico para notificaciones del sistema
                        </span>
                        <div class="form-error" th:if="${#fields.hasErrors('email')}">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <path d="M12 8v4M12 16h.01"/>
                            </svg>
                            <span th:errors="*{email}">Error</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="form-section">
                <div class="form-section-header">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                        <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
                    </svg>
                    <h3>Acceso y permisos</h3>
                </div>
                <div class="form-grid">
                    <div class="form-field">
                        <label class="form-label" for="rol">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                                <circle cx="9" cy="7" r="4"/>
                                <path d="M23 21v-2a4 4 0 0 0-3-3.87M16 3.13a4 4 0 0 1 0 7.75"/>
                            </svg>
                            Rol en el sistema
                            <span class="required">*</span>
                        </label>
                        <select id="rol" class="form-select" th:field="*{rol}" required>
                            <option value="" disabled th:selected="${usuarioForm.rol == null}">
                                -- Selecciona el rol --
                            </option>
                            <option th:each="rol : ${roles}"
                                    th:value="${rol}"
                                    th:text="${rol.valor}">
                                Rol
                            </option>
                        </select>
                        <span class="form-hint">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <path d="M12 16v-4M12 8h.01"/>
                            </svg>
                            Define los permisos y capacidades del usuario
                        </span>
                        <div class="form-error" th:if="${#fields.hasErrors('rol')}">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <path d="M12 8v4M12 16h.01"/>
                            </svg>
                            <span th:errors="*{rol}">Error</span>
                        </div>
                    </div>

                    <div class="form-field">
                        <label class="form-label">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <path d="M9 12l2 2 4-4"/>
                            </svg>
                            Estado del usuario
                        </label>
                        <label style="display: flex; align-items: center; gap: 0.6rem; cursor: pointer; padding: 0.75rem 1rem; background: var(--surface-2); border-radius: 12px; border: 1px solid var(--border);">
                            <input type="checkbox" th:field="*{activo}" style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="font-weight: 600; color: var(--text);">Usuario activo</span>
                        </label>
                        <span class="form-hint">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <path d="M12 16v-4M12 8h.01"/>
                            </svg>
                            Desactiva para bloquear el acceso temporalmente
                        </span>
                    </div>

                    <div class="form-field full-width">
                        <label class="form-label" for="password">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                                <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
                            </svg>
                            Contraseña
                            <span class="required" th:if="${!isEdit}">*</span>
                        </label>
                        <input id="password" type="password" class="form-input" th:field="*{password}" 
                               placeholder="••••••••">
                        <span class="form-hint" th:if="${isEdit}">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <path d="M12 16v-4M12 8h.01"/>
                            </svg>
                            Deja en blanco para mantener la contraseña actual
                        </span>
                        <span class="form-hint" th:unless="${isEdit}">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <path d="M12 16v-4M12 8h.01"/>
                            </svg>
                            Mínimo 8 caracteres para mayor seguridad
                        </span>
                        <div class="form-error" th:if="${#fields.hasErrors('password')}">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <path d="M12 8v4M12 16h.01"/>
                            </svg>
                            <span th:errors="*{password}">Error</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="form-actions">
                <button class="button primary" type="submit">
                    <svg class="button-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
                        <path d="M17 21v-8H7v8M7 3v5h8"/>
                    </svg>
                    <span th:text="${isEdit} ? 'Guardar cambios' : 'Crear usuario'">Guardar</span>
                </button>
                <a class="button" th:href="@{/usuarios}">Cancelar</a>
            </div>
        </form>
    </div>
</section>
</html>
