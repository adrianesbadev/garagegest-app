<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org" th:replace="~{layout :: layout(~{::section})}">
<section>
    <nav class="breadcrumbs" sec:authorize="isAuthenticated()">
        <a th:href="@{/}">Inicio</a>
        <span class="breadcrumb-separator">/</span>
        <span class="breadcrumb-current">Recordatorios</span>
    </nav>
    <div class="page-header">
        <div>
            <h1>Recordatorios</h1>
            <p>Automatiza avisos de ITV, seguro y revisiones.</p>
        </div>
        <a class="button primary" th:href="@{/recordatorios/nuevo}">
            <svg class="button-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                 stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                <path d="M12 5v14"/>
                <path d="M5 12h14"/>
            </svg>
            Nuevo recordatorio
        </a>
    </div>

    <div class="card table-card">
        <div class="table-wrap">
            <table class="table" id="recordatorios-table">
                <thead>
                <tr>
                    <th>Tipo</th>
                    <th>Modo</th>
                    <th>Vehículo</th>
                    <th>Cliente</th>
                    <th>Fecha objetivo</th>
                    <th>Km objetivo</th>
                    <th>Estado</th>
                    <th>Creado</th>
                    <th>Acciones</th>
                </tr>
                </thead>
                <tbody>
                <tr class="empty-state-row" th:if="${#lists.isEmpty(recordatorios)}">
                    <td colspan="9">
                        <div class="empty-state">
                            <div class="empty-state-icon">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                    <path d="M3 5h18v14H3z"/>
                                    <path d="M7 3v4M17 3v4M3 9h18"/>
                                    <circle cx="12" cy="15" r="1"/>
                                </svg>
                            </div>
                            <h3>No hay recordatorios configurados</h3>
                            <p>Configura recordatorios para ITV, seguros y revisiones para no perder ninguna fecha importante.</p>
                            <a class="button primary" th:href="@{/recordatorios/nuevo}">
                                <svg class="button-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M12 5v14M5 12h14"/>
                                </svg>
                                Crear primer recordatorio
                            </a>
                        </div>
                    </td>
                </tr>
                <tr th:each="recordatorio : ${recordatorios}">
                    <td th:text="${recordatorio.tipo} ?: '-'">Tipo</td>
                    <td>
                        <span class="badge secondary" th:text="${recordatorio.modo != null ? recordatorio.modo.etiqueta : '-'}">Modo</span>
                    </td>
                    <td th:text="${recordatorio.vehiculo != null ? recordatorio.vehiculo.matricula : '-'}">Vehículo</td>
                    <td th:text="${recordatorio.vehiculo != null && recordatorio.vehiculo.cliente != null ? recordatorio.vehiculo.cliente.nombre : '-'}">Cliente</td>
                    <td th:text="${recordatorio.fechaObjetivoFormateada} ?: '-'">Fecha</td>
                    <td th:text="${recordatorio.kmObjetivo} ?: '-'">Km</td>
                    <td th:text="${recordatorio.estado} ?: '-'">Estado</td>
                    <td th:text="${recordatorio.creadoEnFormateado} ?: '-'">Creado</td>
                    <td class="actions-cell">
                        <div class="action-buttons">
                            <a class="icon-button edit" th:href="@{/recordatorios/{id}/editar(id=${recordatorio.idRecordatorio})}"
                               data-tooltip="Editar" aria-label="Editar">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"
                                     stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                                    <path d="M12 20h9"/>
                                    <path d="M16.5 3.5a2.1 2.1 0 0 1 3 3L7 19l-4 1 1-4Z"/>
                                </svg>
                            </a>
                            <form class="inline delete-form" th:action="@{/recordatorios/{id}/eliminar(id=${recordatorio.idRecordatorio})}" method="post"
                                  th:data-tipo="${recordatorio.tipo}">
                                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                                <button class="icon-button delete" type="submit" data-tooltip="Eliminar" aria-label="Eliminar">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"
                                         stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                                        <path d="M3 6h18"/>
                                        <path d="M8 6V4h8v2"/>
                                        <path d="M19 6l-1 14H6L5 6"/>
                                        <path d="M10 11v6"/>
                                        <path d="M14 11v6"/>
                                    </svg>
                                </button>
                            </form>
                        </div>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Paginación -->
    <div th:if="${totalItems > 0}" class="pagination">
        <div class="pagination-info" th:if="${totalItems > 0}">
            Mostrando <strong th:text="${currentPage * pageSize + 1}">1</strong> - 
            <strong th:text="${(currentPage * pageSize + pageSize) > totalItems ? totalItems : (currentPage * pageSize + pageSize)}">10</strong> 
            de <strong th:text="${totalItems}">0</strong> registros
        </div>
        <div class="pagination-info" th:if="${totalItems == 0}">
            No hay registros
        </div>
        
        <div class="pagination-controls" th:if="${totalPages > 1}">
            <a th:if="${currentPage > 2}" th:href="@{/recordatorios(page=0, size=${pageSize})}" 
               class="pagination-btn" aria-label="Primera página">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M18 18V6M6 6l6 6-6 6"/>
                </svg>
            </a>
            
            <a th:href="@{/recordatorios(page=${currentPage - 1}, size=${pageSize})}" 
               class="pagination-btn" 
               th:classappend="${currentPage == 0} ? 'disabled'"
               aria-label="Página anterior">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M15 18l-6-6 6-6"/>
                </svg>
            </a>
            
            <th:block th:each="pageNum : ${#numbers.sequence(0, totalPages - 1)}">
                <a th:if="${pageNum == 0 || pageNum == totalPages - 1 || (pageNum >= currentPage - 1 && pageNum <= currentPage + 1)}"
                   th:href="@{/recordatorios(page=${pageNum}, size=${pageSize})}" 
                   class="pagination-btn"
                   th:classappend="${pageNum == currentPage} ? 'active'"
                   th:text="${pageNum + 1}">1</a>
                <span th:if="${pageNum == currentPage - 2 && currentPage > 3}" class="pagination-btn disabled">...</span>
                <span th:if="${pageNum == currentPage + 2 && currentPage < totalPages - 4}" class="pagination-btn disabled">...</span>
            </th:block>
            
            <a th:href="@{/recordatorios(page=${currentPage + 1}, size=${pageSize})}" 
               class="pagination-btn" 
               th:classappend="${currentPage >= totalPages - 1} ? 'disabled'"
               aria-label="Página siguiente">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M9 18l6-6-6-6"/>
                </svg>
            </a>
            
            <a th:if="${currentPage < totalPages - 3}"
               th:href="@{/recordatorios(page=${totalPages - 1}, size=${pageSize})}" 
               class="pagination-btn" 
               th:classappend="${currentPage >= totalPages - 1} ? 'disabled'"
               aria-label="Última página">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M6 6v12M18 18l-6-6 6-6"/>
                </svg>
            </a>
        </div>
        
        <div class="pagination-size-selector">
            <label for="pageSize-recordatorios">Mostrar:</label>
            <select id="pageSize-recordatorios" onchange="changePageSize(this.value)">
                <option value="5" th:selected="${pageSize == 5}">5</option>
                <option value="10" th:selected="${pageSize == 10}">10</option>
                <option value="25" th:selected="${pageSize == 25}">25</option>
                <option value="50" th:selected="${pageSize == 50}">50</option>
                <option value="100" th:selected="${pageSize == 100}">100</option>
            </select>
        </div>
    </div>

    <script th:src="@{/js/list-search.js}"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Inicializar búsqueda
            new ListSearch('#recordatorios-table', 'Buscar por tipo, vehículo, cliente, estado...');
            
            // Manejar eliminación
            const deleteForms = document.querySelectorAll('.delete-form');
            deleteForms.forEach(form => {
                form.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    const tipo = form.dataset.tipo || 'este recordatorio';
                    const confirmed = await confirmDelete(
                        '¿Eliminar recordatorio?',
                        `¿Estás seguro de que deseas eliminar el recordatorio de ${tipo}? Esta acción no se puede deshacer.`
                    );
                    if (confirmed) {
                        form.submit();
                    }
                });
            });
        });
    </script>
</section>
</html>
