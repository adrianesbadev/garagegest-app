<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org" th:replace="~{layout :: layout(~{::section})}">
<section>
    <nav class="breadcrumbs" sec:authorize="isAuthenticated()">
        <a th:href="@{/}">Inicio</a>
        <span class="breadcrumb-separator">/</span>
        <a th:href="@{/recordatorios}">Recordatorios</a>
        <span class="breadcrumb-separator">/</span>
        <span class="breadcrumb-current" th:text="${isEdit} ? 'Editar' : 'Nuevo'">Formulario</span>
    </nav>
    <div class="page-header">
        <div>
            <h1 th:text="${isEdit} ? 'Editar recordatorio' : 'Nuevo recordatorio'">Formulario</h1>
            <p th:text="${isEdit} ? 'Modifica el recordatorio de mantenimiento' : 'Crea un nuevo recordatorio de ITV, seguro o revisión'">
                Descripción del formulario
            </p>
        </div>
        <a class="button" th:href="@{/recordatorios}">
            <svg class="button-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M19 12H5M12 19l-7-7 7-7"/>
            </svg>
            Volver
        </a>
    </div>

    <div class="card form-card">
        <form th:action="@{${action}}" th:object="${recordatorio}" method="post">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
            
            <div class="form-section">
                <div class="form-section-header">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M5 17h14v-4H5z"/>
                        <path d="M19 3H5C3.9 3 3 3.9 3 5v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z"/>
                    </svg>
                    <h3>Vehículo y tipo</h3>
                </div>
                <div class="form-grid">
                    <div class="form-field">
                        <label class="form-label" for="vehiculo">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M5 17h14v-4H5z"/>
                                <rect x="3" y="5" width="18" height="14" rx="2"/>
                            </svg>
                            Vehículo
                            <span class="required">*</span>
                        </label>
                        <select id="vehiculo" class="form-select" th:field="*{vehiculo.idVehiculo}" required>
                            <option value="" disabled
                                    th:selected="${recordatorio.vehiculo == null || recordatorio.vehiculo.idVehiculo == null}">
                                -- Selecciona el vehículo --
                            </option>
                            <option th:each="vehiculo : ${vehiculos}"
                                    th:value="${vehiculo.idVehiculo}"
                                    th:attr="data-km=${vehiculo.kmActual != null ? vehiculo.kmActual : 0}"
                                    th:text="${vehiculo.matricula + ' - ' + (vehiculo.cliente != null ? vehiculo.cliente.nombre : '')}">
                                Vehículo
                            </option>
                        </select>
                        <span class="form-hint">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <path d="M12 16v-4M12 8h.01"/>
                            </svg>
                            Vehículo para el que se crea el recordatorio
                        </span>
                        <div class="form-error" th:if="${#fields.hasErrors('vehiculo')}">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <path d="M12 8v4M12 16h.01"/>
                            </svg>
                            <span th:errors="*{vehiculo}">Error</span>
                        </div>
                    </div>

                    <div class="form-field">
                        <label class="form-label" for="tipo">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M20 7h-9M14 17H5M15 3h6v6M9 15v6M9 21l-6-6M21 3l-6 6"/>
                            </svg>
                            Tipo de recordatorio
                        </label>
                        <input id="tipo" type="text" class="form-input" th:field="*{tipo}" 
                               placeholder="Ej: ITV, Seguro, Revisión, Cambio aceite...">
                        <span class="form-hint">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <path d="M12 16v-4M12 8h.01"/>
                            </svg>
                            Describe brevemente el tipo de mantenimiento
                        </span>
                        <div class="form-error" th:if="${#fields.hasErrors('tipo')}">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <path d="M12 8v4M12 16h.01"/>
                            </svg>
                            <span th:errors="*{tipo}">Error</span>
                        </div>
                    </div>

                    <div class="form-field full-width">
                        <label class="form-label" for="estado">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <path d="M12 6v6l4 2"/>
                            </svg>
                            Estado
                        </label>
                        <input id="estado" type="text" class="form-input" th:field="*{estado}" 
                               placeholder="Ej: Pendiente, Completado, Vencido...">
                        <span class="form-hint">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <path d="M12 16v-4M12 8h.01"/>
                            </svg>
                            Estado actual del recordatorio
                        </span>
                        <div class="form-error" th:if="${#fields.hasErrors('estado')}">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <path d="M12 8v4M12 16h.01"/>
                            </svg>
                            <span th:errors="*{estado}">Error</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="form-section">
                <div class="form-section-header">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/>
                        <path d="M12 6v6l4 2"/>
                    </svg>
                    <h3>Configuración del recordatorio</h3>
                </div>
                <div class="form-grid single-col">
                    <div class="form-field">
                        <label class="form-label" for="modo">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
                            </svg>
                            Modo de activación
                            <span class="required">*</span>
                        </label>
                        <select id="modo" class="form-select" th:field="*{modo}" required>
                            <option value="" disabled
                                    th:selected="${recordatorio.modo == null}">
                                -- Selecciona cuándo activar el recordatorio --
                            </option>
                            <option th:each="modo : ${modos}"
                                    th:value="${modo}"
                                    th:text="${modo.etiqueta}">
                                Modo
                            </option>
                        </select>
                        <span class="form-hint">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <path d="M12 16v-4M12 8h.01"/>
                            </svg>
                            Determina si el recordatorio se activa por fecha, kilometraje o ambos
                        </span>
                        <div class="form-error" th:if="${#fields.hasErrors('modo')}">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <path d="M12 8v4M12 16h.01"/>
                            </svg>
                            <span th:errors="*{modo}">Error</span>
                        </div>
                    </div>
                </div>

                <div class="form-grid">
                    <div class="form-field">
                        <label class="form-label" for="fechaObjetivo">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                                <path d="M16 2v4M8 2v4M3 10h18"/>
                            </svg>
                            Fecha objetivo
                        </label>
                        <input id="fechaObjetivo" type="date" class="form-input" th:field="*{fechaObjetivo}">
                        <span class="form-hint">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <path d="M12 16v-4M12 8h.01"/>
                            </svg>
                            Fecha límite para realizar el mantenimiento
                        </span>
                        <div class="form-error" th:if="${#fields.hasErrors('fechaObjetivo')}">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <path d="M12 8v4M12 16h.01"/>
                            </svg>
                            <span th:errors="*{fechaObjetivo}">Error</span>
                        </div>
                    </div>

                    <div class="form-field">
                        <label class="form-label" for="kmObjetivo">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <path d="M12 6v6l4 2"/>
                            </svg>
                            Kilometraje objetivo
                        </label>
                        <div class="input-icon-group">
                            <input id="kmObjetivo" type="number" class="form-input with-addon" th:field="*{kmObjetivo}" 
                                   min="0" step="1" placeholder="Ej: 100000">
                            <span class="input-addon">km</span>
                        </div>
                        <span class="form-hint" id="kmHint">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <path d="M12 16v-4M12 8h.01"/>
                            </svg>
                            Kilómetros a los que realizar el mantenimiento
                        </span>
                        <div class="form-error" th:if="${#fields.hasErrors('kmObjetivo')}">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <path d="M12 8v4M12 16h.01"/>
                            </svg>
                            <span th:errors="*{kmObjetivo}">Error</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="form-actions">
                <button class="button primary" type="submit">
                    <svg class="button-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
                        <path d="M17 21v-8H7v8M7 3v5h8"/>
                    </svg>
                    <span th:text="${isEdit} ? 'Guardar cambios' : 'Crear recordatorio'">Guardar</span>
                </button>
                <a class="button" th:href="@{/recordatorios}">Cancelar</a>
            </div>
        </form>
    </div>

    <script th:src="@{/js/recordatorios.js}"></script>
</section>
</html>
