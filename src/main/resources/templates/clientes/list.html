<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org" th:replace="~{layout :: layout(~{::section})}">
<section>
    <nav class="breadcrumbs" sec:authorize="isAuthenticated()">
        <a th:href="@{/}">Inicio</a>
        <span class="breadcrumb-separator">/</span>
        <span class="breadcrumb-current">Clientes</span>
    </nav>
    <div class="page-header">
        <div>
            <h1>Clientes</h1>
            <p>Administra la información de tus clientes y su historial.</p>
        </div>
        <div class="form-actions">
            <a class="button success" th:href="@{/clientes/exportar}">
                <svg class="button-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                     stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                    <polyline points="7 10 12 15 17 10"/>
                    <line x1="12" y1="15" x2="12" y2="3"/>
                </svg>
                Exportar datos
            </a>
            <a class="button primary" th:href="@{/clientes/nuevo}">
                <svg class="button-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                     stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                    <path d="M12 5v14"/>
                    <path d="M5 12h14"/>
                </svg>
                Nuevo cliente
            </a>
        </div>
    </div>

    <div class="card table-card">
        <div class="table-wrap">
            <table class="table" id="clientes-table">
                <thead>
                <tr>
                    <th>Nombre</th>
                    <th>Teléfono</th>
                    <th>Email</th>
                    <th>NIF</th>
                    <th>Alta</th>
                    <th>Acciones</th>
                </tr>
                </thead>
                <tbody>
                <tr class="empty-state-row" th:if="${#lists.isEmpty(clientes)}">
                    <td colspan="6">
                        <div class="empty-state">
                            <div class="empty-state-icon">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                                    <circle cx="9" cy="7" r="4"/>
                                    <path d="M23 21v-2a4 4 0 0 0-3-3.87M16 3.13a4 4 0 0 1 0 7.75"/>
                                </svg>
                            </div>
                            <h3>No hay clientes registrados</h3>
                            <p>Comienza añadiendo tu primer cliente al sistema para gestionar su información y vehículos.</p>
                            <a class="button primary" th:href="@{/clientes/nuevo}">
                                <svg class="button-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M12 5v14M5 12h14"/>
                                </svg>
                                Añadir primer cliente
                            </a>
                        </div>
                    </td>
                </tr>
                <tr th:each="cliente : ${clientes}">
                    <td th:text="${cliente.nombre}">Nombre</td>
                    <td th:text="${cliente.telefono} ?: '-'">Teléfono</td>
                    <td class="text-wrap" th:text="${cliente.email} ?: '-'">Email</td>
                    <td th:text="${cliente.nif} ?: '-'">NIF</td>
                    <td th:text="${cliente.fechaAltaFormateada} ?: '-'">Fecha</td>
                    <td>
                        <div class="action-buttons">
                            <a class="button" th:href="@{/clientes/{id}(id=${cliente.idCliente})}">Ver</a>
                            <a class="icon-button edit" th:href="@{/clientes/{id}/editar(id=${cliente.idCliente})}"
                               data-tooltip="Editar" aria-label="Editar">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"
                                     stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                                    <path d="M12 20h9"/>
                                    <path d="M16.5 3.5a2.1 2.1 0 0 1 3 3L7 19l-4 1 1-4Z"/>
                                </svg>
                            </a>
                            <form class="inline delete-form" th:action="@{/clientes/{id}/eliminar(id=${cliente.idCliente})}" method="post"
                                  th:data-nombre="${cliente.nombre}">
                                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                                <button class="icon-button delete" type="submit" data-tooltip="Eliminar" aria-label="Eliminar">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"
                                         stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                                        <path d="M3 6h18"/>
                                        <path d="M8 6V4h8v2"/>
                                        <path d="M19 6l-1 14H6L5 6"/>
                                        <path d="M10 11v6"/>
                                        <path d="M14 11v6"/>
                                    </svg>
                                </button>
                            </form>
                        </div>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Paginación -->
    <div th:if="${totalItems > 0}" class="pagination">
        <div class="pagination-info" th:if="${totalItems > 0}">
            Mostrando <strong th:text="${currentPage * pageSize + 1}">1</strong> - 
            <strong th:text="${(currentPage * pageSize + pageSize) > totalItems ? totalItems : (currentPage * pageSize + pageSize)}">10</strong> 
            de <strong th:text="${totalItems}">0</strong> registros
        </div>
        <div class="pagination-info" th:if="${totalItems == 0}">
            No hay registros
        </div>
        
        <div class="pagination-controls" th:if="${totalPages > 1}">
            <a th:if="${currentPage > 2}" th:href="@{/clientes(page=0, size=${pageSize})}" 
               class="pagination-btn" aria-label="Primera página">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M18 18V6M6 6l6 6-6 6"/>
                </svg>
            </a>
            
            <a th:href="@{/clientes(page=${currentPage - 1}, size=${pageSize})}" 
               class="pagination-btn" 
               th:classappend="${currentPage == 0} ? 'disabled'"
               aria-label="Página anterior">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M15 18l-6-6 6-6"/>
                </svg>
            </a>
            
            <th:block th:each="pageNum : ${#numbers.sequence(0, totalPages - 1)}">
                <a th:if="${pageNum == 0 || pageNum == totalPages - 1 || (pageNum >= currentPage - 1 && pageNum <= currentPage + 1)}"
                   th:href="@{/clientes(page=${pageNum}, size=${pageSize})}" 
                   class="pagination-btn"
                   th:classappend="${pageNum == currentPage} ? 'active'"
                   th:text="${pageNum + 1}">1</a>
                <span th:if="${pageNum == currentPage - 2 && currentPage > 3}" class="pagination-btn disabled">...</span>
                <span th:if="${pageNum == currentPage + 2 && currentPage < totalPages - 4}" class="pagination-btn disabled">...</span>
            </th:block>
            
            <a th:href="@{/clientes(page=${currentPage + 1}, size=${pageSize})}" 
               class="pagination-btn" 
               th:classappend="${currentPage >= totalPages - 1} ? 'disabled'"
               aria-label="Página siguiente">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M9 18l6-6-6-6"/>
                </svg>
            </a>
            
            <a th:if="${currentPage < totalPages - 3}"
               th:href="@{/clientes(page=${totalPages - 1}, size=${pageSize})}" 
               class="pagination-btn" 
               th:classappend="${currentPage >= totalPages - 1} ? 'disabled'"
               aria-label="Última página">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M6 6v12M18 18l-6-6 6-6"/>
                </svg>
            </a>
        </div>
        
        <div class="pagination-size-selector">
            <label for="pageSize-clientes">Mostrar:</label>
            <select id="pageSize-clientes" onchange="changePageSize(this.value)">
                <option value="5" th:selected="${pageSize == 5}">5</option>
                <option value="10" th:selected="${pageSize == 10}">10</option>
                <option value="25" th:selected="${pageSize == 25}">25</option>
                <option value="50" th:selected="${pageSize == 50}">50</option>
                <option value="100" th:selected="${pageSize == 100}">100</option>
            </select>
        </div>
    </div>

    <script th:src="@{/js/list-search.js}"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Inicializar búsqueda
            new ListSearch('#clientes-table', 'Buscar por nombre, teléfono, email, NIF...');
            
            // Manejar eliminación
            const deleteForms = document.querySelectorAll('.delete-form');
            deleteForms.forEach(form => {
                form.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    const nombre = form.dataset.nombre || 'este cliente';
                    const confirmed = await confirmDelete(
                        '¿Eliminar cliente?',
                        `¿Estás seguro de que deseas eliminar a ${nombre}? Esta acción no se puede deshacer y se eliminarán todos los datos relacionados.`
                    );
                    if (confirmed) {
                        form.submit();
                    }
                });
            });
        });
    </script>
</section>
</html>
